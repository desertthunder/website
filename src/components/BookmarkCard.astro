---
import "$styles/cards.css";
import { truncate, truncateWords } from "$utils/text";

type Props = { slug: string; title: string; url: string; date: Date; categories: string[]; content?: string };

const { slug, title, url, date, categories, content } = Astro.props;
const dateStr = date.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" });
const displayTitle = truncate(title, 60);
const displayContent = content ? truncateWords(content, 60) : undefined;
const initialCategories = categories.slice(0, 2);
const hiddenCategories = categories.slice(2);
---

<article class="tui-card bookmark-card">
  <div class="card-body">
    <header>
      <h3 class="title">
        <a href={`/bookmarks/${slug}/`} class="title-link" title={`View ${displayTitle}`}>
          {displayTitle}
        </a>
      </h3>
      <time datetime={date.toISOString()} class="date">{dateStr}</time>
    </header>
    {displayContent && <p class="content">{displayContent}</p>}
    <a href={url} class="url" target="_blank" rel="noopener noreferrer" title={url}>
      {url}
    </a>
    {
      categories.length > 0 && (
        <div class="categories" data-expanded="false">
          {initialCategories.map((category) => (
            <a href={`/tags/${encodeURIComponent(category)}/`} class="category" data-category={category}>
              {category}
            </a>
          ))}
          {hiddenCategories.map((category) => (
            <a
              href={`/tags/${encodeURIComponent(category)}/`}
              class="category is-hidden"
              data-hidden
              data-category={category}>
              {category}
            </a>
          ))}
          {hiddenCategories.length > 0 && (
            <button type="button" class="category toggle" data-toggle aria-expanded="false">
              <span aria-hidden="true">â€¦</span>
              <span class="sr-only">Show all tags</span>
            </button>
          )}
        </div>
      )
    }
  </div>
</article>

<script>
  import { setupTagToggles } from "$utils/tag-toggle";
  setupTagToggles();
</script>
