---
import "$styles/cards.css";

type Props = {
  slug: string;
  title: string;
  description: string;
  status: string;
  tech: string[];
  tags: string[];
  repo: string;
};

const { slug, title, description, status, tech, tags, repo } = Astro.props;
const initialTags = tags.slice(0, 2);
const hiddenTags = tags.slice(2);
---

<article data-card>
  <header>
    <a href={`/projects/${slug}`}>
      <h3>{title}</h3>
    </a>
    <span class="status">{status}</span>
  </header>
  <p>{description}</p>
  {
    tech.length > 0 && (
      <div class="tech-stack">
        <span class="tech-label">Tech:</span>
        {tech.map((t) => (
          <span class="tech-badge">{t}</span>
        ))}
      </div>
    )
  }

  {
    tags.length > 0 && (
      <div class="categories" data-expanded="false">
        {initialTags.map((tag) => (
          <span class="category">{tag}</span>
        ))}
        {hiddenTags.map((tag) => (
          <span class="category is-hidden" data-hidden>
            {tag}
          </span>
        ))}
        {hiddenTags.length > 0 && (
          <button type="button" class="category toggle" data-toggle aria-expanded="false">
            <span aria-hidden="true">…</span>
            <span class="sr-only">Show all tags</span>
          </button>
        )}
      </div>
    )
  }
  <div class="card-footer">
    <a href={repo} target="_blank" rel="noopener noreferrer" class="repo-link"> View on GitHub → </a>
  </div>
</article>

<script>
  import { setupTagToggles } from "$utils/tag-toggle";
  setupTagToggles();
</script>

<style>
  .tech-stack {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 0.5rem;
    padding: 0.5rem 1.5rem;
  }

  .tech-label {
    color: var(--muted);
    font-size: 0.85rem;
    font-weight: 600;
  }

  .tech-badge {
    background: color-mix(in oklab, var(--panel), black 12%);
    color: var(--cyan);
    padding: 0.2rem 0.6rem;
    border-radius: 3px;
    font-size: 0.75rem;
    border: 1px solid var(--line);
    font-family: monospace;
  }

  .card-footer {
    padding: 0 1.5rem 1.25rem 1.5rem;
    border-top: 1px dotted var(--line);
    margin-top: 0.75rem;
    padding-top: 0.75rem;
  }

  .repo-link {
    color: var(--muted);
    font-size: 0.9rem;
    text-decoration: none;
    transition: color 0.2s;
  }

  .repo-link:hover {
    color: var(--cyan);
    text-decoration: underline;
  }
</style>
